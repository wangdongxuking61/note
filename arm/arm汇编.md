### c嵌入汇编

```assembly
asm volatile(
"mov r0, %0 \n" // %0也是寄存器
""
""
:"=&r"(a), "+r"(b) //输出变量、输入输出变量
:"r"(c) // 输入变量
:"r0", "r1" // 保护寄存器
)
```

#### ARM64经常用到的汇编指令

```objectivec
MOV    X1，X0         ;将寄存器X0的值传送到寄存器X1
ADD    X0，X1，X2     ;寄存器X1和X2的值相加后传送到X0
SUB    X0，X1，X2     ;寄存器X1和X2的值相减后传送到X0
AND    X0，X0，#0xF    ; X0的值与0xF相位与后的值传送到X0
ORR    X0，X0，#9      ; X0的值与9相位或后的值传送到X0
EOR    X0，X0，#0xF    ; X0的值与0xF相异或后的值传送到X0
LDR    X5，[X6，#0x08]        ；X6寄存器加0x08的和的地址值内的数据传送到X5
STR X0, [SP, #0x8]         ；X0寄存器的数据传送到SP+0x8地址值指向的存储空间
STP  x29, x30, [sp, #0x10]    ;入栈指令
LDP  x29, x30, [sp, #0x10]    ;出栈指令
CBZ  ;比较（Compare），如果结果为零（Zero）就转移（只能跳到后面的指令）
CBNZ ;比较，如果结果非零（Non Zero）就转移（只能跳到后面的指令）
CMP  ;比较指令，相当于SUBS，影响程序状态寄存器CPSR 
B/BL  ;绝对跳转#imm， 返回地址保存到LR（X30）
RET   ;子程序返回指令，返回地址默认保存在LR（X30）
```

### arm64寄存器

ARM64 有34个寄存器，包括31个通用寄存器、SP、PC、CPSR。

| 寄存器  | 位数  | 描述                                                         |
| ------- | :---: | :----------------------------------------------------------- |
| x0-x30  | 64bit | 通用寄存器，如果有需要可以当做32bit使用：WO-W30              |
| FP(x29) | 64bit | 保存栈帧地址(栈底指针)                                       |
| LR(x30) | 64bit | 通常称X30为程序链接寄存器，保存子程序结束后需要执行的下一条指令 |
| SP      | 64bit | 保存栈指针,使用 SP/WSP来进行对SP寄存器的访问。               |
| PC      | 64bit | 程序计数器，俗称PC指针，总是指向即将要执行的下一条指令,在arm64中，软件是不能改写PC寄存器的。 |
| CPSR    | 64bit | 状态寄存器                                                   |

#### 通用寄存器

```
X0 - X30：64位通用寄存器
W0 - W30：X的32位的格式，w0是x0的低32位
读取：从W寄存器中读取时，忽略对应的X寄存器的高32位并且保持他们不变。 
写入：写入W寄存器将X寄存器的高32位设置为零。 因此，将0xFFFFFFFF写入W0会将X0设置为0x00000000FFFFFFFF。

注意：有时Rn用来指定一个ARMv8-A寄存器。 这意味着寄存器可以是Xn或Wn。
```

#### 特殊寄存器

> 参考：https://www.jianshu.com/p/b29bb8f2e727

除了31个（X0到X30）个ARMv8-A核心寄存器之外，还有几个特殊的寄存器。

```
注意：没有名为X31或W31的寄存器。 一些指令被编码了，以使数字31代表零寄存器ZR（WZR / XZR）。 还有一组受限制的指令，其中一个或多个参数被编码，以使数字31代表堆栈指针（SP）。
```

| 名字 | 大小    | 描述       |
| ---- | ------- | ---------- |
| WZR  | 32 bits | 零寄存器   |
| XZR  | 64 bits | 零寄存器   |
| WSP  | 32 bits | 当前栈指针 |
| SP   | 64 bits | 当前栈指针 |
| PC   | 64 bits | 程序计数器 |

> 注意：64位格式的堆栈指针不使用X前缀。